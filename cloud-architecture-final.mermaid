graph TB
    %% Mobile App Layer
    MA["Mobile App<br/>(User Interface & SMS Parser)<br/>• SMS Detection<br/>• Transaction Display<br/>• Budget Tracking"]
    
    %% API Layer
    API[API Layer<br/>Django REST Framework]
    
    %% Backend Services
    subgraph Backend["Backend Services"]
        BE[Django Backend]
        WS["WebSocket Server<br/>• Live Updates<br/>• Real-time Notifications"]
        Cache[(Redis Cache<br/>Performance Layer)]
    end
    
    %% AWS Cloud Services
    subgraph AWS["AWS Cloud Infrastructure"]
        EC2[AWS EC2<br/>Hosts Backend Services]
        
        subgraph MLServices["ML Services"]
            Lambda[AWS Lambda<br/>ML Models]
        end
        
        subgraph Storage["Storage & Backup"]
            RDS[("AWS RDS PostgreSQL<br/>Primary DB (Region 1)<br/>Replica DB (Region 2)")]
            S3["AWS S3<br/>• Static Files<br/>• Database Backups<br/>• Application Logs"]
        end
        
        subgraph DR["Disaster Recovery"]
            Backup["Automated Backup Strategy<br/>• Daily RDS Snapshots<br/>• Cross-region Replication<br/>• Point-in-time Recovery"]
        end
        
        subgraph Monitoring["Monitoring & Notifications"]
            SNS[Amazon SNS<br/>Push Notifications]
            CW[CloudWatch<br/>System Monitoring]
        end
        
        %% Database Tables
        subgraph DB["Database Schema"]
            Users[Users<br/>Auth & Profiles]
            Trans[Transactions<br/>SMS & Categories]
            Cat[Categories<br/>Hierarchy]
            Budg[Budgets<br/>Limits & Tracking]
        end
    end
    
    %% Data Processing Flows (Solid Lines)
    MA -->|"1. Send SMS Data"| API
    API -->|"2. Process Requests"| BE
    BE -->|"3. Store"| RDS
    RDS -->|"4. Retrieve"| BE
    BE <-->|"5. Cache Data"| Cache
    BE -->|"6. Prediction Request"| Lambda
    Lambda -->|"7. Results"| BE
    
    %% Storage Flows (Dotted Lines)
    BE -.->|"Store Static Files"| S3
    BE -.->|"Store Backups"| S3
    RDS -.->|"Daily Backup"| Backup
    
    %% Real-time Updates (Thick Lines)
    BE ==>|"Trigger Notifications"| SNS
    SNS ==>|"Push to Device"| MA
    BE ==>|"Real-time Updates"| WS
    WS ==>|"Live WebSocket Feed"| MA
    
    %% Monitoring Flows (Dashed Lines)
    CW -.->|"Monitor"| EC2
    CW -.->|"Monitor"| RDS
    CW -.->|"Monitor"| Lambda
    
    %% Database Connections
    RDS --- Users
    RDS --- Trans
    RDS --- Cat
    RDS --- Budg

    %% Styles
    classDef aws fill:#ff9900,stroke:#232F3E,stroke-width:2px,color:white;
    classDef db fill:#3498db,stroke:#2980b9,stroke-width:2px,color:white;
    classDef app fill:#2ecc71,stroke:#27ae60,stroke-width:2px,color:white;
    classDef cache fill:#e74c3c,stroke:#c0392b,stroke-width:2px,color:white;
    classDef dr fill:#9b59b6,stroke:#8e44ad,stroke-width:2px,color:white;
    
    class EC2,Lambda,RDS,S3,SNS,CW aws;
    class Users,Trans,Cat,Budg db;
    class MA,API,BE,WS app;
    class Cache cache;
    class Backup,DR dr;

    %% Legend
    subgraph Legend["Legend"]
        L1[AWS Services]
        L2[Database Components]
        L3[Application Services]
        L4[Caching Layer]
        L5[Disaster Recovery]
        
        %% Arrow Types
        L6[" "] -->|"Data Flow"| L7[" "]
        L8[" "] ==>|"Real-time Updates"| L9[" "]
        L10[" "] -.->|"Monitoring/Backup"| L11[" "]
    end
    
    class L1 aws;
    class L2 db;
    class L3 app;
    class L4 cache;
    class L5 dr;
